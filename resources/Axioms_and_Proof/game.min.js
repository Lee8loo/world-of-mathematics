/* (c) 2016 Mathigon */
function Game(){this.numDisks=$("#numDisks").val(),this.towers=[],this.disks=[],this.moves=0}function getNum(o){return getLast(o.attr("id"))}function getLast(s){return s.charAt(s.length-1)}var NUM_TOWERS=3,TOWER_WIDTH=$("#Hanoi").width()/3-1,TOWER_HEIGHT=190,TOWER_XWIDTH=10,DISK_WIDTHS=[.3*TOWER_WIDTH,.4*TOWER_WIDTH,.5*TOWER_WIDTH,.6*TOWER_WIDTH,.7*TOWER_WIDTH,.8*TOWER_WIDTH,.9*TOWER_WIDTH],DISK_HEIGHT=24,FONT_SIZE=14,FONT_FACE='"futura-pt", Futura Std, "Futura", "Helvetica", sans-serif';Game.prototype.init=function(){this.clean(),this.createTowers(),this.createDisks(),this.initTowers(),this.initDisks(),this.positionDisks(),this.updateDraggableDisks()},Game.prototype.clean=function(){$("#HanoiGame").empty(),$("#images").empty(),$("#moves").html(0)},Game.prototype.createTowers=function(){for(var i=0;NUM_TOWERS>i;i++){var tower=new Tower(i,TOWER_WIDTH,TOWER_HEIGHT,TOWER_XWIDTH,$.proxy(this.handleDrop,this));this.towers.push(tower),$("#HanoiGame").append(tower.createElement())}$("#images").append(tower.createImageElement())},Game.prototype.initTowers=function(){for(var i=0;i<this.towers.length;i++)this.towers[i].init()},Game.prototype.createDisks=function(){for(var i=0;i<this.numDisks;i++){var disk=new Disk(i,DISK_WIDTHS[i],DISK_HEIGHT,FONT_SIZE,FONT_FACE,$.proxy(this.handleDrag,this));this.disks.push(disk),$("#HanoiGame").append(disk.createElement()),$("#images").append(disk.createImageElement())}for(var j=this.numDisks-1;j>=0;j--)this.towers[0].addDisk(this.disks[j]),this.disks[j].setTower(this.towers[0])},Game.prototype.initDisks=function(){for(var i=0;i<this.disks.length;i++)this.disks[i].init()},Game.prototype.positionDisks=function(){for(var i=0;i<this.disks.length;i++)this.disks[i].position()},Game.prototype.updateDraggableDisks=function(){for(var i=0;i<this.towers.length;i++)this.towers[i].updateDraggableDisks()},Game.prototype.handleDrag=function(event,ui){this.getDisk($(event.target)).setDraggableRevert(!0)},Game.prototype.handleDrop=function(event,ui){var tower=this.getTower($(event.target)),disk=this.getDisk(ui.draggable);tower.getNum()!=disk.getTower().getNum()&&(this.moves++,$("#moves").text(this.moves),tower.canPlaceDisk(disk)&&(disk.setDraggableRevert(!1),tower.moveDisk(disk),disk.position(),this.updateDraggableDisks(),this.checkSolved()))},Game.prototype.checkSolved=function(){for(var i=1;i<this.towers.length;i++)if(this.towers[i].getDisks().length==this.disks.length){alert("Solved in "+this.moves+" moves."),$("#startOver").click();break}},Game.prototype.getTower=function(elem){return this.towers[getNum(elem)]},Game.prototype.getDisk=function(elem){return this.disks[getNum(elem)]};