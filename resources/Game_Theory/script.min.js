/* (c) 2016 Mathigon */
scripts.Game_Theory=function(){function SlideshowGoTo(wrap,n){var $old=wrap.find("p.on"),$new=wrap.find("p:eq("+n+")");wrap.height(wrap.height()).addClass("changing"),$old.removeClass("on"),setTimeout(function(){wrap.addClass("animateHeight").height($new.height())},150),setTimeout(function(){$new.addClass("on")},300),setTimeout(function(){wrap.removeClass("animateHeight changing").css("height","auto")},600)}function NimTable(x){switch($(".col0, .col1, .col2, .col3, #row0 td, #row1 td, #row2 td, #row3 td, #row4 td, .colx").css({color:"#000","font-weight":"500",opacity:"0"}),x){case 1:$(".col0").css({color:"#D90000","font-weight":"700"}),$("#row0 td").css({color:"#0040FF","font-weight":"700"});break;case 2:$("#row1 td").css({color:"#00B200","font-weight":"700"});break;case 3:$("#row2 td").css({color:"#3CF","font-weight":"700"});break;case 4:$("#row3 td").css({color:"#006DD9","font-weight":"700"});break;case 6:$(".col3").css({color:"#F60","font-weight":"700"});break;case 7:$(".col2").css({color:"#906","font-weight":"700"});break;case 8:$(".col1").css({color:"#F09","font-weight":"700"});break;case 9:$("#row4 td").css({color:"#D90000","font-weight":"700"}),$(".colx").css({color:"#D90000","font-weight":"700"})}x>=1&&$(".col0, #row0 td").css("opacity","1"),x>=2&&$("       #row1 td").css("opacity","1"),x>=3&&$("       #row2 td").css("opacity","1"),x>=4&&$("       #row3 td").css("opacity","1"),x>=6&&$(".col3          ").css("opacity","1"),x>=7&&$(".col2          ").css("opacity","1"),x>=8&&$(".col1          ").css("opacity","1"),x>=9&&$("       #row4 td").css("opacity","1")}function BinaryDigitalSum(x){for(var binary=[],i=0;i<x.length;i++){var my=x[i];binary[i]=[0,0,0,0,0,0,0],my>=64&&(binary[i][6]=1,my-=64),my>=32&&(binary[i][5]=1,my-=32),my>=16&&(binary[i][4]=1,my-=16),my>=8&&(binary[i][3]=1,my-=8),my>=4&&(binary[i][2]=1,my-=4),my>=2&&(binary[i][1]=1,my-=2),my>=1&&(binary[i][0]=1,my-=1)}for(var binarySum=[0,0,0,0,0,0,0],i=0;7>i;i++){for(var j=0;j<x.length;j++)binarySum[i]+=binary[j][i];binarySum[i]=binarySum[i]%2}var sum=1*binarySum[0]+2*binarySum[1]+4*binarySum[2]+8*binarySum[3]+16*binarySum[4]+32*binarySum[5]+64*binarySum[6];return sum}function mySum(x){s=0;for(var i=0;i<x.length;i++)s+=x[i];return s}function NimSolution(){for(var temp=0,i=0;i<NimPiles.length;i++)for(var j=0;j<NimPiles[i];j++)if(temp=NimPiles.slice(0),temp[i]=j,0==BinaryDigitalSum(temp))return temp;return NimPiles}function NimSetup(){$("#NimLost, #NimWon").addClass("off");var myNim=$("#NimText").val().replace("(","").replace(")","").split(","),myText="<tr>";NimOriginal=[],NimPiles=[];for(var i=0;i<myNim.length;i++){myText+="<td>";for(var j=0;j<Number(myNim[i]);j++)myText+="<div class='NimCounter' id='nim_"+i+"_"+j+"' ></div>";myText+="</td>",NimOriginal[i]=Number(myNim[i])||0,NimPiles[i]=Number(myNim[i])||0}myText+="</tr>",$("#NimTable").html(myText),$(".NimCounter").mouseenter(function(){if(Nim.running&&!$(this).hasClass("off"))for(var myID=$(this).attr("id").split("_"),i=0;i<=Number(myID[2]);i++)$("#nim_"+myID[1]+"_"+i).addClass("half")}),$(".NimCounter").mouseleave(function(){$(".NimCounter.half").removeClass("half")}),$(".NimCounter").click(function(){if(Nim.running&&!$(this).hasClass("off")){Nim.running=0;for(var myID=$(this).attr("id").split("_"),i=0;i<=Number(myID[2]);i++)$("#nim_"+myID[1]+"_"+i).addClass("off");NimPiles[Number(myID[1])]=NimOriginal[Number(myID[1])]-Number(myID[2])-1,Nim.nextTurn()}}),Nim.running=1}var Choc1={running:1,userBox:0,userCount:0,chocTotal:0,userEat:function(td){var available=1-td.hasClass("off"),whichBox=Number(td.parents(".choc_box").attr("id").charAt(7));0==Choc1.userBox&&(Choc1.userBox=whichBox,$("#choc_1_"+(3-whichBox)).removeClass("on"),$("#chocButton").addClass("on")),available&&whichBox==Choc1.userBox?(Choc1.userCount++,Choc1.chocTotal++,td.addClass("off")):available&&alert("You can only take chocolates from one box.")},nextTurn:function(){Choc1.running=0,$("#chocButton").removeClass("on").addClass("off"),setTimeout(function(){var set1=0;for(i=1;i<=9;i++){var myChoc=$("#choc_1_"+(3-Choc1.userBox)+" .ch_"+i);!myChoc.hasClass("off")&&set1<Choc1.userCount&&(myChoc.addClass("off"),set1++)}},500),setTimeout(function(){Choc1.chocTotal+=Choc1.userCount,Choc1.userCount=0,Choc1.userBox=0,Choc1.chocTotal<18?(Choc1.running=1,$(".choc_box").addClass("on"),$("#chocButton").removeClass("off")):($(".choc_box").removeClass("on"),$("#chocButton").html("You lost! Click to start over.").removeClass("off").addClass("on").addClass("ended")),Choc1.running=1},1e3)},resetBox:function(){Choc1.running=1,Choc1.chocTotal=0,$(".choc_box").addClass("on"),$("#choc_1_wrap td").removeClass("off"),$("#chocButton").addClass("off").removeClass("ended"),setTimeout(function(){$("#chocButton").html("Click to end your turn").removeClass("off")},550)}};$("#choc_1_wrap td").click(function(e){Choc1.running&&Choc1.userEat($(this))}),$("#chocButton").click(function(e){$(this).hasClass("ended")?Choc1.resetBox():Choc1.userCount>0?Choc1.nextTurn():alert("You need to take at least one chocolate!")});var s1count=1;$("#GamesSlide1 .slideshowLeft").click(function(){s1count>1&&($("#c_1_"+s1count).css("opacity","0"),s1count--,SlideshowGoTo($("#GamesSlide1 .slideshowText"),s1count-1)),1==s1count&&$("#c_1_0").css("opacity","1"),7==s1count&&$("#c_1_7").css("opacity","1"),10==s1count&&$("#c_1_10").css("opacity","1"),12==s1count&&$("#c_1_12").css("opacity","1"),1==s1count&&$("#GamesSlide1 .slideshowLeft").addClass("off"),13==s1count&&$("#GamesSlide1 .slideshowRight").removeClass("off")}),$("#GamesSlide1 .slideshowRight").click(function(){14>s1count&&(s1count++,$("#c_1_"+s1count).css("opacity","1"),SlideshowGoTo($("#GamesSlide1 .slideshowText"),s1count-1)),2==s1count&&$("#c_1_0").css("opacity","0"),8==s1count&&$("#c_1_7").css("opacity","0"),11==s1count&&$("#c_1_10").css("opacity","0"),13==s1count&&$("#c_1_12").css("opacity","0"),2==s1count&&$("#GamesSlide1 .slideshowLeft").removeClass("off"),14==s1count&&$("#GamesSlide1 .slideshowRight").addClass("off")});var s2count=1;$("#GamesSlide2 .slideshowLeft").click(function(){s2count>1&&($("#c_2_"+s2count).css("opacity","0"),s2count--,SlideshowGoTo($("#GamesSlide2 .slideshowText"),s2count-1)),1==s2count&&$("#GamesSlide2 .slideshowLeft").addClass("off"),8==s2count&&$("#GamesSlide2 .slideshowRight").removeClass("off")}),$("#GamesSlide2 .slideshowRight").click(function(){9>s2count&&(s2count++,$("#c_2_"+s2count).css("opacity","1"),SlideshowGoTo($("#GamesSlide2 .slideshowText"),s2count-1)),2==s2count&&$("#GamesSlide2 .slideshowLeft").removeClass("off"),9==s2count&&$("#GamesSlide2 .slideshowRight").addClass("off")});var NimCount=1;NimTable(1),$("#NimSlideshow .slideshowLeft").click(function(){NimCount>1&&(NimCount--,NimTable(NimCount),SlideshowGoTo($("#NimSlideshow .slideshowText"),NimCount-1)),1==NimCount&&$("#NimSlideshow .slideshowLeft").addClass("off"),8==NimCount&&$("#NimSlideshow .slideshowRight").removeClass("off")}),$("#NimSlideshow .slideshowRight").click(function(){9>NimCount&&(NimCount++,NimTable(NimCount),SlideshowGoTo($("#NimSlideshow .slideshowText"),NimCount-1)),2==NimCount&&$("#NimSlideshow .slideshowLeft").removeClass("off"),9==NimCount&&$("#NimSlideshow .slideshowRight").addClass("off")});var NimOriginal=[],NimPiles=[],Nim={running:1,nextTurn:function(){0==mySum(NimPiles)?$("#NimWon").removeClass("off"):0==BinaryDigitalSum(NimPiles)?setTimeout(function(){var myCounter=$(".NimCounter:not(.off):eq(0)");myCounter.addClass("off");var myPile=Number(myCounter.attr("id").split("_")[1]);NimPiles[myPile]--,Nim.running=1},900):setTimeout(function(){for(var myNew=NimSolution(),i=0;i<NimPiles.length;i++)if(myNew[i]!=NimPiles[i])for(var j=0;j<NimOriginal[i]-myNew[i];j++)$("#nim_"+i+"_"+j).addClass("off");NimPiles=myNew,0==mySum(NimPiles)?$("#NimLost").removeClass("off"):Nim.running=1},900)}};$("#NimButton").click(function(){NimSetup()}),NimSetup()};